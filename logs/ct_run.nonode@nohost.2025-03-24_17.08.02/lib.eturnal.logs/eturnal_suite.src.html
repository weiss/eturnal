<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/home/runner/work/eturnal/eturnal/_build/test/lib/eturnal/test/eturnal_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <i>%%% eturnal STUN/TURN server.</i>
<a name="2"/>    2: <i>%%%</i>
<a name="3"/>    3: <i>%%% Copyright (c) 2020-2023 Holger Weiss &lt;holger@zedat.fu-berlin.de&gt;.</i>
<a name="4"/>    4: <i>%%% Copyright (c) 2020-2023 ProcessOne, SARL.</i>
<a name="5"/>    5: <i>%%% All rights reserved.</i>
<a name="6"/>    6: <i>%%%</i>
<a name="7"/>    7: <i>%%% Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</i>
<a name="8"/>    8: <i>%%% you may not use this file except in compliance with the License.</i>
<a name="9"/>    9: <i>%%% You may obtain a copy of the License at</i>
<a name="10"/>   10: <i>%%%</i>
<a name="11"/>   11: <i>%%%     http://www.apache.org/licenses/LICENSE-2.0</i>
<a name="12"/>   12: <i>%%%</i>
<a name="13"/>   13: <i>%%% Unless required by applicable law or agreed to in writing, software</i>
<a name="14"/>   14: <i>%%% distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</i>
<a name="15"/>   15: <i>%%% WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</i>
<a name="16"/>   16: <i>%%% See the License for the specific language governing permissions and</i>
<a name="17"/>   17: <i>%%% limitations under the License.</i>
<a name="18"/>   18: 
<a name="19"/>   19: <b>-module</b>(eturnal_SUITE).
<a name="20"/>   20: <b>-compile</b>(export_all).
<a name="21"/>   21: <b>-include_lib</b>(&quot;common_test/include/ct.hrl&quot;).
<a name="22"/>   22: 
<a name="23"/>   23: <b>-type info</b>() :: ct_suite:ct_info().
<a name="24"/>   24: <b>-type config</b>() :: ct_suite:ct_config().
<a name="25"/>   25: <b>-type test_def</b>() :: ct_suite:ct_test_def().
<a name="26"/>   26: <b>-type test_name</b>() :: ct_suite:ct_testname().
<a name="27"/>   27: <b>-type group_def</b>() :: ct_suite:ct_group_def().
<a name="28"/>   28: <b>-type group_name</b>() :: ct_suite:ct_groupname().
<a name="29"/>   29: 
<a name="30"/>   30: <i>%% API.</i>
<a name="31"/>   31: 
<a name="32"/>   32: <b>-spec suite</b>() -&gt; [info()].
<a name="suite-0"/><a name="33"/>   33: <b>suite</b>() -&gt;
<a name="suite-last_expr"/><a name="34"/>   34:     [{require, {server, [address, udp_port, tcp_port, tls_port, auto_port]}},
<a name="35"/>   35:      {timetrap, {seconds, 120}}].
<a name="36"/>   36: 
<a name="37"/>   37: <b>-spec init_per_suite</b>(config()) -&gt; config().
<a name="init_per_suite-1"/><a name="38"/>   38: <b>init_per_suite</b>(Config) -&gt;
<a name="39"/>   39:     Server = ct:get_config(server),
<a name="40"/>   40:     Address = proplists:get_value(address, Server),
<a name="41"/>   41:     UdpPort = proplists:get_value(udp_port, Server),
<a name="42"/>   42:     TcpPort = proplists:get_value(tcp_port, Server),
<a name="43"/>   43:     TlsPort = proplists:get_value(tls_port, Server),
<a name="44"/>   44:     AutoPort = proplists:get_value(auto_port, Server),
<a name="init_per_suite-last_expr"/><a name="45"/>   45:     [{address, Address},
<a name="46"/>   46:      {udp_port, UdpPort},
<a name="47"/>   47:      {tcp_port, TcpPort},
<a name="48"/>   48:      {tls_port, TlsPort},
<a name="49"/>   49:      {auto_port, AutoPort} | Config].
<a name="50"/>   50: 
<a name="51"/>   51: <b>-spec end_per_suite</b>(config()) -&gt; ok.
<a name="end_per_suite-1"/><a name="52"/>   52: <b>end_per_suite</b>(_Config) -&gt;
<a name="end_per_suite-last_expr"/><a name="53"/>   53:     ok.
<a name="54"/>   54: 
<a name="55"/>   55: <b>-spec init_per_group</b>(group_name(), config()) -&gt; config().
<a name="init_per_group-2"/><a name="56"/>   56: <b>init_per_group</b>(_GroupName, Config) -&gt;
<a name="init_per_group-last_expr"/><a name="57"/>   57:     Config.
<a name="58"/>   58: 
<a name="59"/>   59: <b>-spec end_per_group</b>(group_name(), config()) -&gt; ok.
<a name="end_per_group-2"/><a name="60"/>   60: <b>end_per_group</b>(_GroupName, _Config) -&gt;
<a name="end_per_group-last_expr"/><a name="61"/>   61:     ok.
<a name="62"/>   62: 
<a name="63"/>   63: <b>-spec init_per_testcase</b>(test_name(), config()) -&gt; config().
<a name="64"/>   64: <b>-ifdef</b>(old_inet_backend).
<a name="65"/>   65: init_per_testcase(start_eturnal, Config) -&gt;
<a name="66"/>   66:     set_eturnal_env(&quot;eturnal-old-otp.yml&quot;, Config);
<a name="67"/>   67: init_per_testcase(stun_tcp_auto, _Config) -&gt;
<a name="68"/>   68:     {skip, otp_version_unsupported};
<a name="69"/>   69: init_per_testcase(stun_tls_auto, _Config) -&gt;
<a name="70"/>   70:     {skip, otp_version_unsupported};
<a name="71"/>   71: init_per_testcase(_TestCase, Config) -&gt;
<a name="72"/>   72:     Config.
<a name="73"/>   73: -else.
<a name="init_per_testcase-2"/><a name="74"/>   74: <b>init_per_testcase</b>(start_eturnal, Config) -&gt;
<a name="75"/>   75:     set_eturnal_env(&quot;eturnal-new-otp.yml&quot;, Config);
<a name="76"/>   76: <b>init_per_testcase</b>(_TestCase, Config) -&gt;
<a name="init_per_testcase-last_expr"/><a name="77"/>   77:     Config.
<a name="78"/>   78: -endif.
<a name="79"/>   79: 
<a name="80"/>   80: <b>-spec end_per_testcase</b>(test_name(), config()) -&gt; ok.
<a name="end_per_testcase-2"/><a name="81"/>   81: <b>end_per_testcase</b>(_TestCase, _Config) -&gt;
<a name="end_per_testcase-last_expr"/><a name="82"/>   82:     ok.
<a name="83"/>   83: 
<a name="84"/>   84: <b>-spec groups</b>() -&gt; [group_def()].
<a name="groups-0"/><a name="85"/>   85: <b>groups</b>() -&gt;
<a name="groups-last_expr"/><a name="86"/>   86:     [].
<a name="87"/>   87: 
<a name="88"/>   88: <b>-spec all</b>() -&gt; [test_def()] | {skip, term()}.
<a name="all-0"/><a name="89"/>   89: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="90"/>   90:     [start_eturnal,
<a name="91"/>   91:      check_status,
<a name="92"/>   92:      check_info,
<a name="93"/>   93:      check_all_sessions,
<a name="94"/>   94:      check_user_sessions,
<a name="95"/>   95:      check_disconnect,
<a name="96"/>   96:      check_credentials,
<a name="97"/>   97:      check_loglevel,
<a name="98"/>   98:      check_version,
<a name="99"/>   99:      reload,
<a name="100"/>  100:      connect_tcp,
<a name="101"/>  101:      connect_tls,
<a name="102"/>  102:      turn_udp,
<a name="103"/>  103:      stun_udp,
<a name="104"/>  104:      stun_tcp,
<a name="105"/>  105:      stun_tls,
<a name="106"/>  106:      stun_tcp_auto,
<a name="107"/>  107:      stun_tls_auto,
<a name="108"/>  108:      stop_eturnal].
<a name="109"/>  109: 
<a name="110"/>  110: <b>-spec start_eturnal</b>(config()) -&gt; any().
<a name="start_eturnal-1"/><a name="111"/>  111: <b>start_eturnal</b>(_Config) -&gt;
<a name="112"/>  112:     ct:pal(&quot;Starting up eturnal&quot;),
<a name="start_eturnal-last_expr"/><a name="113"/>  113: <b>    ok = eturnal:start</b>().
<a name="114"/>  114: 
<a name="115"/>  115: <b>-spec check_status</b>(config()) -&gt; any().
<a name="check_status-1"/><a name="116"/>  116: <b>check_status</b>(_Config) -&gt;
<a name="117"/>  117:     ct:pal(&quot;Checking eturnal status&quot;),
<a name="118"/>  118:     {ok, Status} = eturnal_ctl:get_status(),
<a name="119"/>  119:     ct:pal(&quot;Got eturnal status: ~p&quot;, [Status]),
<a name="check_status-last_expr"/><a name="120"/>  120: <b>    true = is_list</b>(Status).
<a name="121"/>  121: 
<a name="122"/>  122: <b>-spec check_info</b>(config()) -&gt; any().
<a name="check_info-1"/><a name="123"/>  123: <b>check_info</b>(_Config) -&gt;
<a name="124"/>  124:     ct:pal(&quot;Checking eturnal statistics&quot;),
<a name="125"/>  125:     {ok, Info} = eturnal_ctl:get_info(),
<a name="126"/>  126:     ct:pal(&quot;Got eturnal statistics: ~p&quot;, [Info]),
<a name="check_info-last_expr"/><a name="127"/>  127: <b>    true = is_list</b>(Info).
<a name="128"/>  128: 
<a name="129"/>  129: <b>-spec check_all_sessions</b>(config()) -&gt; any().
<a name="check_all_sessions-1"/><a name="130"/>  130: <b>check_all_sessions</b>(_Config) -&gt;
<a name="131"/>  131:     ct:pal(&quot;Checking active TURN sessions&quot;),
<a name="132"/>  132:     {ok, Sessions} = eturnal_ctl:get_sessions(),
<a name="133"/>  133:     ct:pal(&quot;Got active TURN sessions: ~p&quot;, [Sessions]),
<a name="check_all_sessions-last_expr"/><a name="134"/>  134: <b>    true = is_list</b>(Sessions).
<a name="135"/>  135: 
<a name="136"/>  136: <b>-spec check_user_sessions</b>(config()) -&gt; any().
<a name="check_user_sessions-1"/><a name="137"/>  137: <b>check_user_sessions</b>(_Config) -&gt;
<a name="138"/>  138:     ct:pal(&quot;Checking active TURN sessions of user&quot;),
<a name="139"/>  139:     {ok, Sessions} = eturnal_ctl:get_sessions(&quot;alice&quot;),
<a name="140"/>  140:     ct:pal(&quot;Got active TURN sessions of user: ~p&quot;, [Sessions]),
<a name="141"/>  141:     true = is_list(Sessions),
<a name="142"/>  142:     ct:pal(&quot;Checking active TURN sessions of invalid user&quot;),
<a name="143"/>  143:     {error, Reason} = eturnal_ctl:disconnect(alice),
<a name="check_user_sessions-last_expr"/><a name="144"/>  144: <b>    ct:pal</b>(&quot;Got an error, as expected: ~p&quot;, [Reason]).
<a name="145"/>  145: 
<a name="146"/>  146: <b>-spec check_disconnect</b>(config()) -&gt; any().
<a name="check_disconnect-1"/><a name="147"/>  147: <b>check_disconnect</b>(_Config) -&gt;
<a name="148"/>  148:     ct:pal(&quot;Checking disconnection of TURN user&quot;),
<a name="149"/>  149:     {ok, Msg} = eturnal_ctl:disconnect(&quot;alice&quot;),
<a name="150"/>  150:     ct:pal(&quot;Got result for disconnecting TURN user: ~p&quot;, [Msg]),
<a name="151"/>  151:     true = is_list(Msg),
<a name="152"/>  152:     ct:pal(&quot;Checking disconnection of invalid TURN user&quot;),
<a name="153"/>  153:     {error, Reason} = eturnal_ctl:disconnect(alice),
<a name="check_disconnect-last_expr"/><a name="154"/>  154: <b>    ct:pal</b>(&quot;Got an error, as expected: ~p&quot;, [Reason]).
<a name="155"/>  155: 
<a name="156"/>  156: <b>-spec check_credentials</b>(config()) -&gt; any().
<a name="check_credentials-1"/><a name="157"/>  157: <b>check_credentials</b>(_Config) -&gt;
<a name="158"/>  158:     Timestamp = &quot;2009-10-30 11:00:00Z&quot;,
<a name="159"/>  159:     Username = 1256900400,
<a name="160"/>  160:     Password = &quot;uEKlpcME7MNMMVRV8rUFPCTIFEs=&quot;,
<a name="161"/>  161:     ct:pal(&quot;Checking credentials valid until ~s&quot;, [Timestamp]),
<a name="162"/>  162:     {ok, Credentials} = eturnal_ctl:get_credentials(Timestamp, []),
<a name="163"/>  163:     {ok, [Username, Password], []} =
<a name="164"/>  164:         io_lib:fread(&quot;Username: ~u~~nPassword: ~s&quot;, Credentials),
<a name="165"/>  165:     lists:foreach(
<a name="166"/>  166:       fun(Lifetime) -&gt;
<a name="167"/>  167:               ct:pal(&quot;Checking credentials valid for ~s&quot;, [Lifetime]),
<a name="168"/>  168:               {ok, Creds} = eturnal_ctl:get_credentials(Lifetime, &quot;alice&quot;),
<a name="169"/>  169:               {ok, [Time, Pass], []} =
<a name="170"/>  170:                   io_lib:fread(&quot;Username: ~u:alice~~nPassword: ~s&quot;, Creds),
<a name="171"/>  171:               {ok, Pass} =
<a name="172"/>  172:                   eturnal_ctl:get_password(integer_to_list(Time) ++ &quot;:alice&quot;),
<a name="173"/>  173:               true = erlang:system_time(second) + 86400 - Time &lt; 5
<a name="174"/>  174:       end, [&quot;86400&quot;, &quot;86400s&quot;, &quot;1440m&quot;, &quot;24h&quot;, &quot;1d&quot;]),
<a name="175"/>  175:     ct:pal(&quot;Checking invalid expiry&quot;),
<a name="176"/>  176:     lists:foreach(
<a name="177"/>  177:       fun(Invalid) -&gt;
<a name="178"/>  178:               {error, _Reason1} = eturnal_ctl:get_password(Invalid),
<a name="179"/>  179:               {error, _Reason2} = eturnal_ctl:get_credentials(Invalid, [])
<a name="180"/>  180:       end, [&quot;Invalid&quot;, invalid, [invalid]]),
<a name="181"/>  181:     ct:pal(&quot;Checking invalid suffix&quot;),
<a name="182"/>  182:     {error, _Reason} = eturnal_ctl:get_credentials(Username, invalid),
<a name="183"/>  183:     ct:pal(&quot;Checking static credentials&quot;),
<a name="check_credentials-last_expr"/><a name="184"/>  184: <b>    {ok, &quot;l0vesBob&quot;} = eturnal_ctl:get_password</b>(&quot;alice&quot;).
<a name="185"/>  185: 
<a name="186"/>  186: <b>-spec check_loglevel</b>(config()) -&gt; any().
<a name="check_loglevel-1"/><a name="187"/>  187: <b>check_loglevel</b>(_Config) -&gt;
<a name="188"/>  188:     Level = &quot;debug&quot;,
<a name="189"/>  189:     ct:pal(&quot;Setting log level to ~s&quot;, [Level]),
<a name="190"/>  190:     ok = eturnal_ctl:set_loglevel(list_to_atom(Level)),
<a name="191"/>  191:     ct:pal(&quot;Checking whether log level is set to ~s&quot;, [Level]),
<a name="192"/>  192:     {ok, Level} = eturnal_ctl:get_loglevel(),
<a name="193"/>  193:     ct:pal(&quot;Setting invalid log level&quot;),
<a name="194"/>  194:     {error, _Reason} = eturnal_ctl:set_loglevel(invalid),
<a name="195"/>  195:     ct:pal(&quot;Checking whether log level is still set to ~s&quot;, [Level]),
<a name="check_loglevel-last_expr"/><a name="196"/>  196: <b>    {ok, Level} = eturnal_ctl:get_loglevel</b>().
<a name="197"/>  197: 
<a name="198"/>  198: <b>-spec check_version</b>(config()) -&gt; any().
<a name="check_version-1"/><a name="199"/>  199: <b>check_version</b>(_Config) -&gt;
<a name="200"/>  200:     ct:pal(&quot;Checking eturnal version&quot;),
<a name="201"/>  201:     {ok, Version} = eturnal_ctl:get_version(),
<a name="202"/>  202:     ct:pal(&quot;Got eturnal version: ~p&quot;, [Version]),
<a name="check_version-last_expr"/><a name="203"/>  203: <b>    match = re:run</b>(Version, &quot;^[0-9]+\\.[0-9]+\\.[0-9](\\+[0-9]+)?&quot;,
<a name="204"/>  204:                    [{capture, none}]).
<a name="205"/>  205: 
<a name="206"/>  206: <b>-spec reload</b>(config()) -&gt; any().
<a name="reload-1"/><a name="207"/>  207: <b>reload</b>(_Config) -&gt;
<a name="208"/>  208:     CertFile = &lt;&lt;&quot;run/cert.pem&quot;&gt;&gt;,
<a name="209"/>  209:     ct:pal(&quot;Deleting TLS certificate&quot;),
<a name="210"/>  210:     ok = file:delete(CertFile),
<a name="211"/>  211:     ct:pal(&quot;Reloading eturnal&quot;),
<a name="212"/>  212:     ok = eturnal_ctl:reload(),
<a name="213"/>  213:     ct:pal(&quot;Checking whether new TLS certificate was created&quot;),
<a name="214"/>  214:     {ok, _} = file:read_file_info(CertFile),
<a name="215"/>  215:     ct:pal(&quot;Reloading eturnal without changes&quot;),
<a name="reload-last_expr"/><a name="216"/>  216: <b>    ok = eturnal_ctl:reload</b>().
<a name="217"/>  217: 
<a name="218"/>  218: <b>-spec connect_tcp</b>(config()) -&gt; any().
<a name="connect_tcp-1"/><a name="219"/>  219: <b>connect_tcp</b>(Config) -&gt;
<a name="220"/>  220:     Addr = ?config(address, Config),
<a name="221"/>  221:     Port = ?config(tcp_port, Config),
<a name="222"/>  222:     ct:pal(&quot;Connecting to 127.0.0.1:~B (TCP)&quot;, [Port]),
<a name="223"/>  223:     {ok, Sock} = gen_tcp:connect(Addr, Port, []),
<a name="connect_tcp-last_expr"/><a name="224"/>  224: <b>    ok = gen_tcp:close</b>(Sock).
<a name="225"/>  225: 
<a name="226"/>  226: <b>-spec connect_tls</b>(config()) -&gt; any().
<a name="connect_tls-1"/><a name="227"/>  227: <b>connect_tls</b>(Config) -&gt;
<a name="228"/>  228:     Addr = ?config(address, Config),
<a name="229"/>  229:     Port = ?config(tls_port, Config),
<a name="230"/>  230:     ct:pal(&quot;Connecting to 127.0.0.1:~B (TLS)&quot;, [Port]),
<a name="231"/>  231:     {ok, TCPSock} = gen_tcp:connect(Addr, Port, []),
<a name="232"/>  232:     {ok, TLSSock} = fast_tls:tcp_to_tls(TCPSock, [connect]),
<a name="connect_tls-last_expr"/><a name="233"/>  233: <b>    ok = fast_tls:close</b>(TLSSock).
<a name="234"/>  234: 
<a name="235"/>  235: <b>-spec turn_udp</b>(config()) -&gt; any().
<a name="turn_udp-1"/><a name="236"/>  236: <b>turn_udp</b>(Config) -&gt;
<a name="237"/>  237:     Addr = ?config(address, Config),
<a name="238"/>  238:     Port = ?config(udp_port, Config),
<a name="239"/>  239:     Username1 = &lt;&lt;&quot;alice&quot;&gt;&gt;,
<a name="240"/>  240:     Password1 = &lt;&lt;&quot;l0vesBob&quot;&gt;&gt;,
<a name="241"/>  241:     Username2 = &lt;&lt;&quot;2145913200&quot;&gt;&gt;,
<a name="242"/>  242:     Password2 = &lt;&lt;&quot;cLwpKS2/9bWHf+agUImD47PIXNE=&quot;&gt;&gt;,
<a name="243"/>  243:     Realm = &lt;&lt;&quot;eturnal.net&quot;&gt;&gt;,
<a name="244"/>  244:     ct:pal(&quot;Allocating TURN relay on 127.0.0.1:~B (UDP)&quot;, [Port]),
<a name="245"/>  245:     ok = stun_test:allocate_udp(Addr, Port, Username1, Realm, Password1),
<a name="turn_udp-last_expr"/><a name="246"/>  246: <b>    ok = stun_test:allocate_udp</b>(Addr, Port, Username2, Realm, Password2).
<a name="247"/>  247: 
<a name="248"/>  248: <b>-spec stun_udp</b>(config()) -&gt; any().
<a name="stun_udp-1"/><a name="249"/>  249: <b>stun_udp</b>(Config) -&gt;
<a name="250"/>  250:     Addr = ?config(address, Config),
<a name="251"/>  251:     Port = ?config(udp_port, Config),
<a name="252"/>  252:     ct:pal(&quot;Performing STUN query against 127.0.0.1:~B (UDP)&quot;, [Port]),
<a name="253"/>  253:     Result = stun_test:bind_udp(Addr, Port),
<a name="254"/>  254:     ct:pal(&quot;Got query result: ~p&quot;, [Result]),
<a name="255"/>  255:     true = is_tuple(Result),
<a name="stun_udp-last_expr"/><a name="256"/>  256: <b>    true = element</b>(1, Result) =:= stun.
<a name="257"/>  257: 
<a name="258"/>  258: <b>-spec stun_tcp</b>(config()) -&gt; any().
<a name="stun_tcp-1"/><a name="259"/>  259: <b>stun_tcp</b>(Config) -&gt;
<a name="260"/>  260:     Addr = ?config(address, Config),
<a name="261"/>  261:     Port = ?config(tcp_port, Config),
<a name="262"/>  262:     ct:pal(&quot;Performing STUN query against 127.0.0.1:~B (TCP)&quot;, [Port]),
<a name="263"/>  263:     Result = stun_test:bind_tcp(Addr, Port),
<a name="264"/>  264:     ct:pal(&quot;Got query result: ~p&quot;, [Result]),
<a name="265"/>  265:     true = is_tuple(Result),
<a name="stun_tcp-last_expr"/><a name="266"/>  266: <b>    true = element</b>(1, Result) =:= stun.
<a name="267"/>  267: 
<a name="268"/>  268: <b>-spec stun_tls</b>(config()) -&gt; any().
<a name="stun_tls-1"/><a name="269"/>  269: <b>stun_tls</b>(Config) -&gt;
<a name="270"/>  270:     Addr = ?config(address, Config),
<a name="271"/>  271:     Port = ?config(tls_port, Config),
<a name="272"/>  272:     ct:pal(&quot;Performing STUN query against 127.0.0.1:~B (TLS)&quot;, [Port]),
<a name="273"/>  273:     Result = stun_test:bind_tls(Addr, Port),
<a name="274"/>  274:     ct:pal(&quot;Got query result: ~p&quot;, [Result]),
<a name="275"/>  275:     true = is_tuple(Result),
<a name="stun_tls-last_expr"/><a name="276"/>  276: <b>    true = element</b>(1, Result) =:= stun.
<a name="277"/>  277: 
<a name="278"/>  278: <b>-spec stun_tcp_auto</b>(config()) -&gt; any().
<a name="stun_tcp_auto-1"/><a name="279"/>  279: <b>stun_tcp_auto</b>(Config) -&gt;
<a name="280"/>  280:     Addr = ?config(address, Config),
<a name="281"/>  281:     Port = ?config(auto_port, Config),
<a name="282"/>  282:     ct:pal(&quot;Performing STUN query against 127.0.0.1:~B (TCP)&quot;, [Port]),
<a name="283"/>  283:     Result = stun_test:bind_tcp(Addr, Port),
<a name="284"/>  284:     ct:pal(&quot;Got query result: ~p&quot;, [Result]),
<a name="285"/>  285:     true = is_tuple(Result),
<a name="stun_tcp_auto-last_expr"/><a name="286"/>  286: <b>    true = element</b>(1, Result) =:= stun.
<a name="287"/>  287: 
<a name="288"/>  288: <b>-spec stun_tls_auto</b>(config()) -&gt; any().
<a name="stun_tls_auto-1"/><a name="289"/>  289: <b>stun_tls_auto</b>(Config) -&gt;
<a name="290"/>  290:     Addr = ?config(address, Config),
<a name="291"/>  291:     Port = ?config(auto_port, Config),
<a name="292"/>  292:     ct:pal(&quot;Performing STUN query against 127.0.0.1:~B (TLS)&quot;, [Port]),
<a name="293"/>  293:     Result = stun_test:bind_tls(Addr, Port),
<a name="294"/>  294:     ct:pal(&quot;Got query result: ~p&quot;, [Result]),
<a name="295"/>  295:     true = is_tuple(Result),
<a name="stun_tls_auto-last_expr"/><a name="296"/>  296: <b>    true = element</b>(1, Result) =:= stun.
<a name="297"/>  297: 
<a name="298"/>  298: <b>-spec stop_eturnal</b>(config()) -&gt; any().
<a name="stop_eturnal-1"/><a name="299"/>  299: <b>stop_eturnal</b>(_Config) -&gt;
<a name="300"/>  300:     ct:pal(&quot;Stopping eturnal&quot;),
<a name="stop_eturnal-last_expr"/><a name="301"/>  301: <b>    ok = eturnal:stop</b>().
<a name="302"/>  302: 
<a name="303"/>  303: <i>%% Internal functions.</i>
<a name="304"/>  304: 
<a name="305"/>  305: <b>-spec set_eturnal_env</b>(file:filename_all(), config()) -&gt; config().
<a name="set_eturnal_env-2"/><a name="306"/>  306: <b>set_eturnal_env</b>(ConfName, Config) -&gt;
<a name="307"/>  307:     DataDir = ?config(data_dir, Config),
<a name="308"/>  308:     ConfFile = filename:join(DataDir, ConfName),
<a name="309"/>  309:     ok = application:set_env(conf, file, ConfFile),
<a name="310"/>  310:     ok = application:set_env(conf, on_fail, stop),
<a name="311"/>  311:     ok = application:set_env(eturnal, on_fail, exit),
<a name="set_eturnal_env-last_expr"/><a name="312"/>  312:     Config.
</pre>
<script>
var hash = window.location.hash.substring(1);
var anchor = document.getElementsByName(hash);
anchor[0].style.backgroundColor="orange";
</script>
</body>
</html>
